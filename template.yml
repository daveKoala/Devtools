services:
  core-api:
    clone: SHARED_NET=my-shared-net docker compose up -d --build
    # clone: git clone git@bitbucket.org:deliveryappuk/core-api.git
    environment:
      APP_ENV: local
      API_PORT: "8080"
      DB_HOST: 127.0.0.1
      DB_DATABASE: core_api
      DB_USERNAME: core
      DB_PASSWORD: secret
      SHARED_NET: my-shared-net
    healthCheck:
      command: "curl -f http://localhost:8080/health"
      interval: 5s
      retries: 6
    postCloneCmds:
      - git checkout dave/monday-morning
      - cp -n .env.example .env
      - docker compose up -d
      - docker compose exec app php artisan migrate
      - docker compose exec app php artisan db:seed
    depends:

  dvla-service:
    clone: "git clone git@bitbucket.org:deliveryappuk/dvla-bot.git"
    environment:
      APP_ENV: local
      API_PORT: "8090"
    healthCheck:
      command: "curl -f http://localhost:8090/health"
      interval: 5s
      retries: 6
    postCloneCmds:
      - cp -n .env.example .env
      - docker compose up -d
    depends:
      - core-api
